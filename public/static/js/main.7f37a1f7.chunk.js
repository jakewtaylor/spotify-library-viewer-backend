(this["webpackJsonpspotify-viewer-api"]=this["webpackJsonpspotify-viewer-api"]||[]).push([[0],{40:function(e,t,r){e.exports=r(92)},92:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(20),s=r.n(c),o=r(17),l=r(1),u=r(2),i=r(21),m=r(12);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var h=function(){return Object(n.useMemo)((function(){return document.cookie.split("; ").reduce((function(e,t){var r=t.split("="),n=Object(m.a)(r,2),a=n[0],c=n[1];return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(r,!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,Object(i.a)({},a,c))}),{})}),[])},p=r(13),b=r(9),k=r.n(b),g=r(14),d=r(15),E=r(11),v=r(16),y=r.n(v),O=r(36),j=r.n(O),w=new(function(){function e(){Object(d.a)(this,e),this.instance=void 0,this._accessToken=localStorage.getItem("access_token")||"",this._refreshToken=localStorage.getItem("refresh_token")||"",this.instance=this.buildInstance()}return Object(E.a)(e,[{key:"accessToken",get:function(){return this._accessToken},set:function(e){localStorage.setItem("access_token",e),this._accessToken=e}},{key:"refreshToken",get:function(){return this._refreshToken},set:function(e){localStorage.setItem("refresh_token",e),this._refreshToken=e}}]),Object(E.a)(e,[{key:"buildInstance",value:function(){var e=this,t=y.a.create({baseURL:"https://api.spotify.com/v1",paramsSerializer:function(e){return Object(p.stringify)(e)}});return j()(t,(function(t){return e.handleRefresh(t)})),t.interceptors.request.use((function(t){return e.accessToken&&(t.headers.Authorization="Bearer ".concat(e.accessToken)),t})),t}},{key:"handleRefresh",value:function(){var e=Object(g.a)(k.a.mark((function e(t){var r=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.a.post("http://spotify-api-viewer.test/api/spotify/refresh-token",{refresh_token:this.refreshToken}).then((function(e){console.log("refreshed:",e),r.accessToken=e.data.access_token})).catch((function(e){console.log("refresh failed!!",{err:e})})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"needsTokens",value:function(){return!this.accessToken}},{key:"setTokens",value:function(e,t){this.accessToken=e,this.refreshToken=t}},{key:"search",value:function(e){return this.instance.get("/search",{params:{q:e,type:["album","artist","track"].join(","),market:"from_token"}})}}]),e}()),x=function(e){var t=e.children,r=h(),c=function(){var e=Object(l.e)().search;return Object(n.useMemo)((function(){return Object(p.parse)(e.slice(1))}),[e])}();return Object(n.useEffect)((function(){var e=r.accessToken||c.accessToken,t=r.refreshToken||c.refreshToken;w.needsTokens()&&e&&t&&w.setTokens(e,t)}),[r,c]),a.a.createElement(a.a.Fragment,null,t)},T=r(38),N=r(37),S=r(39),_=function(e){function t(){var e,r;Object(d.a)(this,t);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return(r=Object(T.a)(this,(e=Object(N.a)(t)).call.apply(e,[this].concat(a)))).state={foundError:!1},r}return Object(S.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return this.state.foundError?a.a.createElement("div",{className:"p-4 text-center"},a.a.createElement("p",{className:"text-gray-400"},"Enter a search term to see some results...")):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return console.log(e),e===t.flag.description?{foundError:!0}:{foundError:!1}}}]),t}(n.Component);_.flag=Symbol("WaitForInput");var R=Object(u.atom)({key:"searchTerm",default:"melvins"}),F=Object(u.selector)({key:"searchResults",get:function(){var e=Object(g.a)(k.a.mark((function e(t){var r,n,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.get,n=r(R),console.log({query:n}),n){e.next=5;break}throw _.flag.description;case 5:return e.next=7,w.search(n);case 7:return a=e.sent,e.abrupt("return",a.data);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),I=Object(u.selector)({key:"searchResults-artists",get:function(e){return(0,e.get)(F).artists}}),P=Object(u.selector)({key:"searchResults-albums",get:function(e){return(0,e.get)(F).albums}}),A=(Object(u.selector)({key:"searchResults-tracks",get:function(e){return(0,e.get)(F).tracks}}),Object(u.atom)({key:"accessToken",default:null,persistence_UNSTABLE:{type:"test"}}),Object(u.atom)({key:"refreshToken",default:null,persistence_UNSTABLE:{type:"test"}}),function(e){var t=e.children;return a.a.createElement("div",{className:"w-48 h-48 rounded-full overflow-hidden bg-gray-800"},t)}),B=function(){var e=Object(u.useRecoilValue)(I);return a.a.createElement(a.a.Fragment,null,e.items.map((function(e,t){return a.a.createElement("div",{key:e.id,className:"flex-shrink-0 mr-4 text-center ".concat(0===t?"ml-4":"")},e.images.length>0?a.a.createElement(A,null,a.a.createElement("img",{src:e.images[0].url,className:"object-cover w-full h-full"})):a.a.createElement(A,null),a.a.createElement("p",{className:"w-48 text-lg font-bold text-gray-400 mt-2"},e.name))})),a.a.createElement("p",null,"\xa0"))},D=function(){return a.a.createElement(a.a.Fragment,null,Array(6).fill(0).map((function(e,t){return a.a.createElement("div",{key:t,className:"flex-shrink-0 mr-4 text-center ".concat(0===t?"ml-4":"")},a.a.createElement(A,null))})))},q=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("h5",{className:"text-2xl font-bold text-gray-400 mt-4 mx-4 mb-2"},"Artists"),a.a.createElement("div",{className:"flex flex-row w-full overflow-scroll"},a.a.createElement(n.Suspense,{fallback:D},a.a.createElement(B,null))))},L=function(){var e=Object(u.useRecoilValue)(P);return a.a.createElement(a.a.Fragment,null,a.a.createElement("h5",{className:"text-2xl font-bold text-gray-400 mt-4 mb-2 mx-4"},"Albums"),a.a.createElement("div",{className:"flex flex-row w-full overflow-scroll"},e.items.map((function(e,t){return a.a.createElement("div",{key:e.id,className:"flex-shrink-0 w-48 mr-4 ".concat(0===t?"ml-4":"")},a.a.createElement("img",{src:e.images[0].url,className:"mb-2"}),a.a.createElement("p",{className:"text-sm text-gray-400 font-semibold whitespace-no-wrap truncate"},e.name),a.a.createElement("p",{className:"text-sm text-gray-400 whitespace-no-wrap"},e.artists.map((function(e){return e.name})).join(", ")))})),a.a.createElement("p",null,"\xa0")))},M=function(){var e=Object(u.useRecoilState)(R),t=Object(m.a)(e,2),r=t[0],c=t[1],s=Object(n.useState)(r),o=Object(m.a)(s,2),l=o[0],i=o[1];return Object(n.useEffect)((function(){var e=setTimeout((function(){c(l)}),500);return function(){return clearTimeout(e)}}),[l,c]),a.a.createElement("div",{className:"p-4"},a.a.createElement("div",{className:"bg-gray-800 rounded"},a.a.createElement("input",{type:"text",value:l,onChange:function(e){return i(e.target.value)},className:"block w-full bg-transparent p-4 text-gray-200 placeholder:text-gray-200 focus:outline-none focus:shadow-lg",placeholder:"Search..."})))},U=function(){var e=Object(u.useRecoilValue)(R);return a.a.createElement("div",{className:"h-full"},a.a.createElement(M,null),e?a.a.createElement(a.a.Fragment,null,a.a.createElement(q,null),a.a.createElement(n.Suspense,{fallback:a.a.createElement("p",null,"loading...")},a.a.createElement(L,null))):a.a.createElement("div",{className:"p-4 text-center"},a.a.createElement("p",{className:"text-gray-400"},"Enter a search term to see some results...")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement((function(){return a.a.createElement(u.RecoilRoot,null,a.a.createElement(o.a,null,a.a.createElement(x,null,a.a.createElement(l.a,{exact:!0,path:"/"},a.a.createElement("p",{className:"text-red-500"},"test"),a.a.createElement(o.b,{to:"/search"},"Go to search")),a.a.createElement(l.a,{exact:!0,path:"/search",component:U}))))}),null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[40,1,2]]]);
//# sourceMappingURL=main.7f37a1f7.chunk.js.map